import streamlit as st
import pandas as pd

st.set_page_config(page_title="Инновационный кредитный рейтинг страны (HDSR v2)", layout="centered")
st.title("HDSR v2: Кредитный рейтинг страны на базе новых критериев")

st.write("Заполните значения по стране, чтобы рассчитать интегральный рейтинг и буквенную оценку методологии HDSR.")

# Ввод новых критериев
st.subheader("Традиционные параметры:")
ВВП_рост = st.number_input('Рост ВВП, %', value=4.1)
Инфляция = st.number_input('Инфляция, %', value=5.0)
Госдолг_к_ВВП = st.number_input('Госдолг к ВВП, %', value=38.0)
Резервы = st.number_input('Международные резервы, млрд $', value=9.6)
Индекс_коррупции = st.number_input('Индекс коррупции (0-100)', value=39.0)
ESG_оценка = st.number_input('ESG-оценка (0–1)', value=0.71)

st.subheader("Уникальные инновационные параметры:")
Индекс_инноваций = st.number_input('Индекс инноваций (0-100)', value=47.0) # например, Global Innovation Index
Цифровая_диплом = st.number_input('Индекс цифровой дипломатии* (0-100)', value=65.0)
Образовательный = st.number_input('Индекс образования (0-100)', value=78.0)
Электронная_госсфера = st.number_input('Электронное госуправление (0-1)', value=0.81)

if st.button('Рассчитать рейтинг'):
    # Нормализация новых критериев (0-10)
    normalized = [
        min(10, max(0, (ВВП_рост+2)/2)),      # >3% — хорошо
        10-Инфляция if Инфляция <= 10 else max(0, 10-Инфляция), # <5% — отлично
        10-Госдолг_к_ВВП/5,                   # <40% — хорошо
        min(10, Резервы),                     # >5 — нормально
        Индекс_коррупции/10,                  # чем выше — тем лучше
        ESG_оценка*10,
        Индекс_инноваций/10,
        Цифровая_диплом/10,
        Образовательный/10,
        Электронная_госсфера*10,
    ]
    weights = [0.10, 0.07, 0.10, 0.07, 0.08, 0.08, 0.15, 0.15, 0.12, 0.08] # Инновации и цифровые параметры имеют больший вес

    # Таблица
    table = [
        ["Рост ВВП", ВВП_рост, normalized[0], weights[0]],
        ["Инфляция", Инфляция, normalized[1], weights[1]],
        ["Госдолг/ВВП", Госдолг_к_ВВП, normalized[2], weights[2]],
        ["Резервы", Резервы, normalized[3], weights[3]],
        ["Индекс коррупции", Индекс_коррупции, normalized[4], weights[4]],
        ["ESG", ESG_оценка, normalized[5], weights[5]],
        ["Индекс инноваций", Индекс_инноваций, normalized[6], weights[6]],
        ["Цифровая дипломатия", Цифровая_диплом, normalized[7], weights[7]],
        ["Индекс образования", Образовательный, normalized[8], weights[8]],
        ["Электронное госуправление", Электронная_госсфера, normalized[9], weights[9]],
    ]
    df = pd.DataFrame(table, columns=["Критерий", "Ввод", "Баллы (0-10)", "Вес"])
    df['Взвешенный балл'] = df['Баллы (0-10)'] * df['Вес']
    total_score = df['Взвешенный балл'].sum()

    def get_letter_rating(score):
        if score >= 9: return 'AAA'
        elif score >= 8: return 'AA'
        elif score >= 7: return 'A'
        elif score >= 6: return 'BBB'
        elif score >= 5: return 'BB'
        elif score >= 4: return 'B'
        else: return 'CCC-D'

    st.subheader("Результаты HDSR v2:")
    st.dataframe(df)
    st.success(f"Интегральный рейтинг: **{total_score:.2f}**")
    st.success(f"Буквенный рейтинг страны: **{get_letter_rating(total_score)}**")

    st.caption(
        """
        *Уникальные критерии: инновации, цифровая дипломатия, образование, электронное госуправление. 
        Формулы расчёта и веса открыты для любой экспертизы. Можно быстро варьировать сценарии и получать свежий рейтинг страны.*
        """
    )

st.write("*Пример: для Беларуси (2025 г.) интегральный рейтинг, рассчитанный с инновационными критериями, демонстрирует её сильные и слабые стороны в электронной экономике.*")
